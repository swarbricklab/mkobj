from pathlib import Path
import pandas as pd

# Global paths from config
out_dir = Path(config['outs']['results'])
log_dir = Path(config['outs']['logs'])

# Load capture list
captures = pd.read_csv(config['deps']['captures'])['capture'].tolist()

# Include rule files - common utilities
include: "rules/common.smk"

# Seurat rules
include: "rules/create_seurat.smk"
include: "rules/merge.smk"

# AnnData rules
include: "rules/create_anndata.smk"
include: "rules/merge_anndata.smk"

# Build target list - both Seurat and AnnData outputs
seurat_target = out_dir / "merged.qs"
anndata_target = out_dir / "merged.h5ad"

# Optionally add metadata if configured
if config.get('deps', {}).get('metadata'):
    include: "rules/metadata.smk"
    include: "rules/metadata_anndata.smk"
    seurat_target = out_dir / "merged_annotated.qs"
    anndata_target = out_dir / "merged_annotated.h5ad"

targets = [seurat_target, anndata_target]

rule all:
    input:
        targets
